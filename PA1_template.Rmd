---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

Setting Global options
```{r setup, echo=TRUE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE,
                      message = FALSE)
```

## Loading and preprocessing the data
Importing tidyverse, dataset and converting date.
```{r importing}
library(tidyverse)
df <- read.csv("activity.csv")
df$date <- as.Date(df$date)
```

## What is mean total number of steps taken per day?
Aggregating data to daily frequency and printing summary.
```{r mean_summary}
df_daily <- df %>% 
    group_by(date) %>% 
    summarise(total_steps = sum(steps, na.rm = TRUE))

df_daily_summary <- df_daily %>% 
    summarise(mean_total = mean(total_steps, na.rm = TRUE),
              median_total = median(total_steps, na.rm = TRUE))

print(paste("mean total number of steps taken per day:", round(df_daily_summary[[1]], 0)))
print(paste("median total number of steps taken per day:", round(df_daily_summary[[2]], 0)))
```

Histogram of Daily Steps
```{r plot1}
g <- ggplot(df_daily, aes(x = total_steps)) +
    geom_histogram(bins = 30, fill = "skyblue", color = "black") +
    labs(title = "Histogram of Daily Steps",
         x = "Total Daily Steps",
         y = "Count")
print(g)
```

## What is the average daily activity pattern?
Average Daily Activity Pattern time series plot.
```{r plot2}
df_interval <- df %>% 
    group_by(interval) %>% 
    summarise(avg_steps = mean(steps, na.rm = TRUE)) %>% 
    arrange(interval)

g2 <- ggplot(df_interval, aes(x = interval, y = avg_steps)) +
    geom_line() +
    labs(
        title = "Average Daily Activity Pattern",
        x = "5-minute Interval",
        y = "Average Steps")

print(g2)
```

5-minute interval, on average across all the days in the dataset, that contains the maximum number of steps.

```{r interval_max}
interval_max <- df_interval %>% 
    slice_max(avg_steps, n = 1) %>% 
    pull(interval)
print(paste("interval which has max average steps:", interval_max))
```

## Imputing missing values
Calculating the number of NA rows.

The result after imputing missing steps shows a histogram that is
more normally distributed. It also reduces the days with zero steps
and more accurately shows true zero step days.
The mean and median also becomes the same as it was previously more
skewered towards zero.

```{r imputation}
missing_values <- df %>% 
    filter(is.na(steps)) %>% 
    nrow()

print(paste("number of missing values:", missing_values))

df_imputed <- df %>% 
    left_join(df_interval, by = "interval") %>% 
    mutate(steps_filled = if_else(is.na(steps), avg_steps, steps))

df_daily_imputed <- df_imputed %>% 
    group_by(date) %>% 
    summarise(total_steps = sum(steps_filled, na.rm = TRUE))
```

Histogram after imputation.
```{r plot3}
g3 <- ggplot(df_daily_imputed, aes(x = total_steps)) +
    geom_histogram(bins = 30, fill = "skyblue", color = "black") +
    labs(title = "Histogram of Daily Imputed Steps",
         x = "Total Daily Imputed Steps",
         y = "Count")
print(g3)
```

Summary of mean and median after imputation.
```{r imputed_summary}
df_daily_imputed_summary <- df_daily_imputed %>% 
    summarise(mean_total = mean(total_steps, na.rm = TRUE),
              median_total = median(total_steps, na.rm = TRUE))

print(paste("Summary of mean imputation:", round(df_daily_imputed_summary[[1]], 0)))

print(paste("Summary of median imputation:", round(df_daily_imputed_summary[[2]], 0)))
```

## Are there differences in activity patterns between weekdays and weekends?

Yes, there are noticeable differences in activity patterns:

- **Weekends show higher overall activity during the daytime**, particularly between **10 AM and 5 PM**.
- **Weekdays have a higher peak 5-minute interval**, with a maximum of about **230 steps at interval 835**, compared to about **167 steps at interval 915** on weekends.

```{r}
df_imputed <- df_imputed %>% 
    mutate(
        day_type = if_else(
            wday(date, label = TRUE) %in% c("Sat", "Sun"),
            "weekend",
            "weekday"),
        day_type = factor(day_type, levels = c("weekend", "weekday")))
```

```{r plot4}
df_imputed_day_type <- df_imputed %>% 
    group_by(interval, day_type) %>% 
    summarise(avg_steps = mean(steps_filled, na.rm = TRUE)) %>% 
    arrange(interval, day_type)

g4 <- ggplot(df_imputed_day_type, aes(x = interval, y = avg_steps)) +
    geom_line() +
    facet_wrap(~ day_type, ncol = 1) +
    labs(
        title = "Average Daily Activity Pattern by Day Type",
        x = "5-minute Interval",
        y = "Average Steps"
    )

print(g4)
```